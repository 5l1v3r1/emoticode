<section id="source">
  <div class="small-column">
    <div id="publisher">
      <span class="author">
        <a href="<%= user_profile_path(username:@source.user.username) %>" title="<%= @source.user.username %> profile">
          <%= avatar_tag @source.user %>
          <%= truncate @source.user.username, :length => 15 %>
        </a>
      </span>

      <span class="info">
        Posted into <%= link_to_language @source.language, :class => 'language' %> 
        <br/>
        <%= time_ago_in_words( Time.at(@source.created_at) ) %> ago
        <br/> 
        <%= @source.views %> views 
      </span>
      
      <ul class="buttons">
        <% if signed_in? %>
          <% if @current_user == @source.user or @current_user.is_admin? %>
            <li>
              <%= link_icon_to 'Edit', 'edit', source_edit_path(@source) %>
            </li>
            <li>
              <%= link_icon_to 'Delete', 'trash', source_delete_path(@source), :data => { :confirm => 'Are you sure?' } %>
            </li>
          <% end %>

          <li>
          <% if @current_user.favorite? @source %>
            <%= link_icon_to 'Unfav', 'thumbs-down', unfavorite_path( id:@source.id, format: :js ), id: "fav-#{@source.id}", method: :post, remote: true  %>
          <% else %>
            <%= link_icon_to 'Fav It!', 'thumbs-up', favorite_path( id:@source.id, format: :js ), id: "fav-#{@source.id}", method: :post, remote: true  %>
          <% end %>
          </li>
        <% else %>
          <li>
            <%= link_icon_to_function "Fav It!", 'thumbs-up', 'showLoginModal()' %>
          </li>
        <% end %>
        </li>
        <li>
          <%= link_icon_to 'Raw', 'file-text', raw_with_language_path( :language_name => @source.language.name, :source_name => @source.name ) %> 
        </li>

        <li>
          <%= link_icon_to_function "Embed", "expand", "$('#embed').modal();" %>
        </li>
      </ul>
    </div>

    <div style="width:120px;height:600px;">
      <script type="text/javascript"><!--
        google_ad_client = "ca-pub-5373888916618771";
        /* emoticode.source.left.minibar */
        google_ad_slot = "6322822178";
        google_ad_width = 120;
        google_ad_height = 600;
        //-->
      </script>
      <script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js"></script>
    </div>

  </div>  

  <div class="medium-column">
    <h1><%= @source.title %></h1>
    <p class="description"><%=raw description(@source) %></p>
    <%=raw highlight(@source) %>

    <%= render :partial => 'comments/box', :locals => { object: @source } %>
  </div>

  <%= render :partial => 'layouts/sidebar', :locals => { with_heading: true, source: @source } %>
</section>

<%= modal_dialog 'embed', 'Embed Me!' do %>
  <textarea><script type="text/javascript" src="<%= @source.url.gsub /\.html$/, '.js' %>"></script></textarea>
<% end %>
