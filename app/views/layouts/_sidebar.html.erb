<div id="sidebar">
  <% if [ 'language', 'source' ].include? controller.controller_name %>
    <% if signed_in? %>
      <% if !defined?(source) or @current_user != source.user %>
        <%= link_icon_to 'Post a Snippet', 'plus-sign', source_new_path, :class => 'pure-button pure-button-green post-button' %>
        <p>
        Build up your personal collection of code snippets with ease and share them with the world!
        </p>
      <% end %>
    <% else %>
      <%= link_icon_to_function 'Post a Snippet', 'plus-sign', 'showLoginModal()', :class => 'pure-button pure-button-green post-button' %>
      <p>
        Build up your personal collection of code snippets with ease and share them with the world!
      </p>
    <% end %>
  <% end %>

  <% if defined? source %>
    <%= render :partial => 'layouts/social_share', :locals => { source: source } %>
    <br/>
    <center>
      <%= adsense :slot => '7272041371', :width => 200, :height => 200 %>    
    </center>
  <% else %>
    <%= render :partial => 'layouts/latest_users', :locals => { with_heading: with_heading } %>  
    <%= render :partial => 'layouts/be_social' %>
  <% end %>

  <br style="clear:both"/>

  <% if defined? source %>
    <% cache( "source_#{source.id}_related", :expires_in => 24.hours ) do %>
      <% if source.related.load.empty? == false %>
        <div class="heading orange">
          <h3>Related Sources</h3>
        </div>
        <ul class="related">
        <% source.related.each do |related| %>
          <li>
            <%= link_to_source related %>
          </li>
        <% end %>
        </ul>
      <% end %>
    <% end %>
  <% end %>

  <% unless @cloud.nil? or @cloud.empty? %>
    <% cache( "tag_cloud_for_#{request.original_url}" ) do %>
    <div class="heading red">
      <h3>Cloud</h3>
    </div>
    <div class="cloud">
      <% tag_cloud(@cloud).each do |v,cloud| %>
        <% tag,size,count = cloud %>
        <%= link_to tag.value, search_path(what: tag.name), { :style => "font-size: #{size}px", :title => "The keyword #{tag.value} has #{count} elements." } %>
      <% end %>
    </div>
    <% end %>
  <% end %>
</div>
